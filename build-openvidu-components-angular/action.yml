name: Build OpenVidu Components Angular
description: Builds and packages the OpenVidu Components Angular library as a GitHub artifact
inputs:
  repository:
    description: 'Repository to checkout for OpenVidu Components Angular'
    required: false
    default: 'OpenVidu/openvidu'
  checkout_ref:
    description: 'Branch, tag, or commit to checkout'
    required: false
    default: 'master'
  artifact_name:
    description: 'Name of the artifact to upload'
    required: false
    default: 'openvidu-components-angular'
outputs:
  artifact_name:
    description: 'Name of the uploaded artifact'
    value: ${{ inputs.artifact_name }}
  package_filename:
    description: 'Filename of the built package'
    value: ${{ steps.build.outputs.package_filename }}
runs:
  using: 'composite'
  steps:
    - name: Checkout OpenVidu Components Angular
      uses: actions/checkout@v4
      with:
        repository: ${{ inputs.repository }}
        ref: ${{ inputs.checkout_ref }}
        path: openvidu-components-angular-source

    - name: Build OpenVidu Components Angular
      id: build
      shell: bash
      working-directory: openvidu-components-angular-source/openvidu-components-angular
      run: |
        echo "Building OpenVidu Components Angular..."

        # Install dependencies and build the library
        npm install
        npm run lib:build

        # Package the built library
        cd dist/openvidu-components-angular
        npm pack

        # Rename to standard name for easier handling
        mv openvidu-components-angular-*.tgz openvidu-components-angular.tgz

        echo "package_filename=openvidu-components-angular.tgz" >> $GITHUB_OUTPUT
        echo "OpenVidu Components Angular built successfully"

    - name: Upload artifact
      uses: actions/upload-artifact@v4
      working-directory: openvidu-components-angular-source/openvidu-components-angular
      with:
        name: ${{ inputs.artifact_name }}
        path: dist/openvidu-components-angular/openvidu-components-angular.tgz
